[
  {
    "ruleId": "AVOID_FLOATING_POINT_DATA_TYPES",
    "description": "Find columns with Double data type",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), [ExplicitDataType] = 8)",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "PROVIDE_FORMAT_STRING_FOR_MEASURES",
    "description": "Find visible measures without a format string",
    "query": "EVALUATE FILTER(INFO.MEASURES(), [FormatString] = \"\" && [IsHidden] = FALSE)",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "EXPRESSION_RELIANT_OBJECTS_MUST_HAVE_AN_EXPRESSION",
    "description": "Find measures with empty expressions",
    "query": "EVALUATE FILTER(INFO.MEASURES(), ISBLANK([Expression]))",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "EXPRESSION_RELIANT_OBJECTS_MUST_HAVE_AN_EXPRESSION",
    "description": "Find calculated columns with empty expressions",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), [Type] = 2 && ISBLANK([Expression]))",
    "objectType": "CalculatedColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "ENSURE_TABLES_HAVE_RELATIONSHIPS",
    "description": "Find tables not in any relationship",
    "query": "EVALUATE VAR _relTables = UNION(SELECTCOLUMNS(INFO.RELATIONSHIPS(), \"ID\", [FromTableID]), SELECTCOLUMNS(INFO.RELATIONSHIPS(), \"ID\", [ToTableID])) RETURN FILTER(INFO.TABLES(), NOT([ID] IN _relTables) && [IsHidden] = FALSE)",
    "objectType": "Table",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "RELATIONSHIP_COLUMNS_SAME_DATA_TYPE",
    "description": "Find relationships where from/to column data types differ",
    "query": "EVALUATE FILTER(INFO.RELATIONSHIPS(), [FromColumnDataType] <> [ToColumnDataType])",
    "objectType": "Relationship",
    "mapResult": {
      "fromTable": "[FromTableID]",
      "toTable": "[ToTableID]"
    }
  },
  {
    "ruleId": "REDUCE_NUMBER_OF_CALCULATED_COLUMNS",
    "description": "Count calculated columns in model (threshold > 5)",
    "query": "EVALUATE ROW(\"CalcColCount\", COUNTROWS(FILTER(INFO.COLUMNS(), [Type] = 2)))",
    "objectType": "Model",
    "mapResult": {
      "count": "[CalcColCount]"
    },
    "threshold": 5
  },
  {
    "ruleId": "NUMERIC_COLUMN_SUMMARIZE_BY",
    "description": "Find visible numeric columns with SummarizeBy not set to None",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), ([ExplicitDataType] = 6 || [ExplicitDataType] = 8 || [ExplicitDataType] = 10) && [SummarizeBy] <> \"None\" && [IsHidden] = FALSE)",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "AVOID_USING_THE_IFERROR_FUNCTION",
    "description": "Find measures using IFERROR",
    "query": "EVALUATE FILTER(INFO.MEASURES(), CONTAINSSTRING([Expression], \"IFERROR\"))",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "AVOID_USING_THE_IFERROR_FUNCTION",
    "description": "Find calculated columns using IFERROR",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), [Type] = 2 && CONTAINSSTRING([Expression], \"IFERROR\"))",
    "objectType": "CalculatedColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "REDUCE_USAGE_OF_CALCULATED_COLUMNS_THAT_USE_THE_RELATED_FUNCTION",
    "description": "Find calculated columns using RELATED",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), [Type] = 2 && CONTAINSSTRING([Expression], \"RELATED\"))",
    "objectType": "CalculatedColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "USE_THE_DIVIDE_FUNCTION_FOR_DIVISION",
    "description": "Find measures using / operator instead of DIVIDE",
    "query": "EVALUATE FILTER(INFO.MEASURES(), CONTAINSSTRING([Expression], \"] /\") || CONTAINSSTRING([Expression], \") /\"))",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "USE_THE_DIVIDE_FUNCTION_FOR_DIVISION",
    "description": "Find calculated columns using / operator instead of DIVIDE",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), [Type] = 2 && (CONTAINSSTRING([Expression], \"] /\") || CONTAINSSTRING([Expression], \") /\")))",
    "objectType": "CalculatedColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "OBJECTS_WITH_NO_DESCRIPTION",
    "description": "Find visible tables without descriptions",
    "query": "EVALUATE FILTER(INFO.TABLES(), ISBLANK([Description]) && [IsHidden] = FALSE)",
    "objectType": "Table",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "OBJECTS_WITH_NO_DESCRIPTION",
    "description": "Find visible measures without descriptions",
    "query": "EVALUATE FILTER(INFO.MEASURES(), ISBLANK([Description]) && [IsHidden] = FALSE)",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "UNNECESSARY_MEASURES",
    "description": "Find hidden measures (candidates for removal)",
    "query": "EVALUATE FILTER(INFO.MEASURES(), [IsHidden] = TRUE)",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "USE_THE_TREATAS_FUNCTION_INSTEAD_OF_INTERSECT",
    "description": "Find measures using INTERSECT instead of TREATAS",
    "query": "EVALUATE FILTER(INFO.MEASURES(), CONTAINSSTRING([Expression], \"INTERSECT\"))",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "EVALUATEANDLOG_SHOULD_NOT_BE_USED_IN_PRODUCTION_MODELS",
    "description": "Find measures using EVALUATEANDLOG",
    "query": "EVALUATE FILTER(INFO.MEASURES(), CONTAINSSTRING([Expression], \"EVALUATEANDLOG\"))",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "REMOVE_AUTO-DATE_TABLE",
    "description": "Find auto-date tables that should be removed",
    "query": "EVALUATE FILTER(INFO.TABLES(), LEFT([Name], 19) = \"DateTableTemplate_\" || LEFT([Name], 15) = \"LocalDateTable_\")",
    "objectType": "CalculatedTable",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "DATE/CALENDAR_TABLES_SHOULD_BE_MARKED_AS_A_DATE_TABLE",
    "description": "Find date/calendar tables not marked as date table",
    "query": "EVALUATE FILTER(INFO.TABLES(), (CONTAINSSTRING(UPPER([Name]), \"DATE\") || CONTAINSSTRING(UPPER([Name]), \"CALENDAR\")) && [DataCategory] <> \"Time\")",
    "objectType": "Table",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "MODEL_SHOULD_HAVE_A_DATE_TABLE",
    "description": "Check if model lacks a date table",
    "query": "EVALUATE ROW(\"HasNoDateTable\", IF(COUNTROWS(FILTER(INFO.TABLES(), [DataCategory] = \"Time\")) = 0, 1, 0))",
    "objectType": "Model",
    "mapResult": {
      "count": "[HasNoDateTable]"
    },
    "threshold": 0
  },
  {
    "ruleId": "SNOWFLAKE_SCHEMA_ARCHITECTURE",
    "description": "Find tables in both from and to sides of relationships (snowflake pattern)",
    "query": "EVALUATE VAR _fromTables = SELECTCOLUMNS(INFO.RELATIONSHIPS(), \"ID\", [FromTableID]) VAR _toTables = SELECTCOLUMNS(INFO.RELATIONSHIPS(), \"ID\", [ToTableID]) RETURN FILTER(INFO.TABLES(), [ID] IN _fromTables && [ID] IN _toTables && [IsHidden] = FALSE)",
    "objectType": "Table",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "MANY-TO-MANY_RELATIONSHIPS_SHOULD_BE_SINGLE-DIRECTION",
    "description": "Find many-to-many relationships with bi-directional filtering",
    "query": "EVALUATE FILTER(INFO.RELATIONSHIPS(), [FromCardinality] = 2 && [ToCardinality] = 2 && [CrossFilteringBehavior] = 2)",
    "objectType": "Relationship",
    "mapResult": {
      "fromTable": "[FromTableID]",
      "toTable": "[ToTableID]"
    }
  },
  {
    "ruleId": "CHECK_IF_BI-DIRECTIONAL_AND_MANY-TO-MANY_RELATIONSHIPS_ARE_VALID",
    "description": "Find bi-directional or many-to-many relationships",
    "query": "EVALUATE FILTER(INFO.RELATIONSHIPS(), ([FromCardinality] = 2 && [ToCardinality] = 2) || [CrossFilteringBehavior] = 2)",
    "objectType": "Relationship",
    "mapResult": {
      "fromTable": "[FromTableID]",
      "toTable": "[ToTableID]"
    }
  },
  {
    "ruleId": "INACTIVE_RELATIONSHIPS_THAT_ARE_NEVER_ACTIVATED",
    "description": "Find inactive relationships",
    "query": "EVALUATE FILTER(INFO.RELATIONSHIPS(), [IsActive] = FALSE)",
    "objectType": "Relationship",
    "mapResult": {
      "fromTable": "[FromTableID]",
      "toTable": "[ToTableID]"
    }
  },
  {
    "ruleId": "AVOID_EXCESSIVE_BI-DIRECTIONAL_OR_MANY-TO-MANY_RELATIONSHIPS",
    "description": "Check if more than 30% of relationships are bi-di or many-to-many",
    "query": "EVALUATE ROW(\"BadRelPct\", DIVIDE(COUNTROWS(FILTER(INFO.RELATIONSHIPS(), [CrossFilteringBehavior] = 2)) + COUNTROWS(FILTER(INFO.RELATIONSHIPS(), [FromCardinality] = 2 && [ToCardinality] = 2)), MAX(COUNTROWS(INFO.RELATIONSHIPS()), 1)) * 100)",
    "objectType": "Model",
    "mapResult": {
      "count": "[BadRelPct]"
    },
    "threshold": 30
  },
  {
    "ruleId": "PERCENTAGE_FORMATTING",
    "description": "Find measures with non-standard percentage formatting",
    "query": "EVALUATE FILTER(INFO.MEASURES(), CONTAINSSTRING([FormatString], \"%\") && [FormatString] <> \"#,0.0%;-#,0.0%;#,0.0%\")",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "INTEGER_FORMATTING",
    "description": "Find measures with non-standard integer formatting",
    "query": "EVALUATE FILTER(INFO.MEASURES(), NOT ISBLANK([FormatString]) && NOT CONTAINSSTRING([FormatString], \"$\") && NOT CONTAINSSTRING([FormatString], \"%\") && [FormatString] <> \"#,0\" && [FormatString] <> \"#,0.0\")",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "FORMAT_FLAG_COLUMNS_AS_YES/NO_VALUE_STRINGS",
    "description": "Find flag columns that should use Yes/No formatting",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), (LEFT([ExplicitName], 2) = \"Is\" && [ExplicitDataType] = 6 && [IsHidden] = FALSE) || (RIGHT([ExplicitName], 5) = \" Flag\" && [ExplicitDataType] <> 1 && [IsHidden] = FALSE))",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "DATECOLUMN_FORMATSTRING",
    "description": "Find date columns with wrong format string",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), CONTAINSSTRING(UPPER([ExplicitName]), \"DATE\") && [ExplicitDataType] = 9 && [FormatString] <> \"mm/dd/yyyy\")",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "MONTHCOLUMN_FORMATSTRING",
    "description": "Find month columns with wrong format string",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), CONTAINSSTRING(UPPER([ExplicitName]), \"MONTH\") && [ExplicitDataType] = 9 && [FormatString] <> \"MMMM yyyy\")",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "MONTH_(AS_A_STRING)_MUST_BE_SORTED",
    "description": "Find month string columns without a sort-by column",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), CONTAINSSTRING(UPPER([ExplicitName]), \"MONTH\") && NOT CONTAINSSTRING(UPPER([ExplicitName]), \"MONTHS\") && [ExplicitDataType] = 1 && ISBLANK([SortByColumnID]))",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "ADD_DATA_CATEGORY_FOR_COLUMNS",
    "description": "Find columns that should have a data category assigned",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), ISBLANK([DataCategory]) && (([ExplicitDataType] = 1 && (CONTAINSSTRING(LOWER([ExplicitName]), \"country\") || CONTAINSSTRING(LOWER([ExplicitName]), \"continent\") || CONTAINSSTRING(LOWER([ExplicitName]), \"city\"))) || (([ExplicitDataType] = 10 || [ExplicitDataType] = 8) && (LOWER([ExplicitName]) = \"latitude\" || LOWER([ExplicitName]) = \"longitude\"))))",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "SPECIAL_CHARS_IN_OBJECT_NAMES",
    "description": "Find tables with special characters in names",
    "query": "EVALUATE FILTER(INFO.TABLES(), SEARCH(UNICHAR(9), [Name], 1, 0) > 0 || SEARCH(UNICHAR(10), [Name], 1, 0) > 0 || SEARCH(UNICHAR(13), [Name], 1, 0) > 0)",
    "objectType": "Table",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "SPECIAL_CHARS_IN_OBJECT_NAMES",
    "description": "Find measures with special characters in names",
    "query": "EVALUATE FILTER(INFO.MEASURES(), SEARCH(UNICHAR(9), [Name], 1, 0) > 0 || SEARCH(UNICHAR(10), [Name], 1, 0) > 0 || SEARCH(UNICHAR(13), [Name], 1, 0) > 0)",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "SPECIAL_CHARS_IN_OBJECT_NAMES",
    "description": "Find columns with special characters in names",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), SEARCH(UNICHAR(9), [ExplicitName], 1, 0) > 0 || SEARCH(UNICHAR(10), [ExplicitName], 1, 0) > 0 || SEARCH(UNICHAR(13), [ExplicitName], 1, 0) > 0)",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "TRIM_OBJECT_NAMES",
    "description": "Find tables with leading/trailing spaces in names",
    "query": "EVALUATE FILTER(INFO.TABLES(), LEFT([Name], 1) = \" \" || RIGHT([Name], 1) = \" \")",
    "objectType": "Table",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "TRIM_OBJECT_NAMES",
    "description": "Find measures with leading/trailing spaces in names",
    "query": "EVALUATE FILTER(INFO.MEASURES(), LEFT([Name], 1) = \" \" || RIGHT([Name], 1) = \" \")",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "TRIM_OBJECT_NAMES",
    "description": "Find columns with leading/trailing spaces in names",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), LEFT([ExplicitName], 1) = \" \" || RIGHT([ExplicitName], 1) = \" \")",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "OBJECTS_SHOULD_NOT_START_OR_END_WITH_A_SPACE",
    "description": "Find tables starting or ending with a space",
    "query": "EVALUATE FILTER(INFO.TABLES(), LEFT([Name], 1) = \" \" || RIGHT([Name], 1) = \" \")",
    "objectType": "Table",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "OBJECTS_SHOULD_NOT_START_OR_END_WITH_A_SPACE",
    "description": "Find measures starting or ending with a space",
    "query": "EVALUATE FILTER(INFO.MEASURES(), LEFT([Name], 1) = \" \" || RIGHT([Name], 1) = \" \")",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  },
  {
    "ruleId": "OBJECTS_SHOULD_NOT_START_OR_END_WITH_A_SPACE",
    "description": "Find columns starting or ending with a space",
    "query": "EVALUATE FILTER(INFO.COLUMNS(), LEFT([ExplicitName], 1) = \" \" || RIGHT([ExplicitName], 1) = \" \")",
    "objectType": "DataColumn",
    "mapResult": {
      "tableName": "[TableID]",
      "columnName": "[ExplicitName]"
    }
  },
  {
    "ruleId": "FIRST_LETTER_OF_OBJECTS_MUST_BE_CAPITALIZED",
    "description": "Find tables with lowercase first letter",
    "query": "EVALUATE FILTER(INFO.TABLES(), UPPER(LEFT([Name], 1)) <> LEFT([Name], 1) && LEN([Name]) > 0)",
    "objectType": "Table",
    "mapResult": {
      "tableName": "[Name]"
    }
  },
  {
    "ruleId": "FIRST_LETTER_OF_OBJECTS_MUST_BE_CAPITALIZED",
    "description": "Find measures with lowercase first letter",
    "query": "EVALUATE FILTER(INFO.MEASURES(), UPPER(LEFT([Name], 1)) <> LEFT([Name], 1) && LEN([Name]) > 0)",
    "objectType": "Measure",
    "mapResult": {
      "tableName": "[TableID]",
      "measureName": "[Name]"
    }
  }
]
